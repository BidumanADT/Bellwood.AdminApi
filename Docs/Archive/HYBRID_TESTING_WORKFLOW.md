# Hybrid Testing Workflow Guide

**Approach**: Automated bash scripts + manual server control + real-time feedback

---

## ?? Workflow Steps

### 1. **Human: Prepare Environment**
```bash
# Terminal 1: Start AuthServer
cd C:\Users\sgtad\source\repos\BellwoodAuthServer
dotnet run

# Terminal 2: Start AdminAPI  
cd C:\Users\sgtad\source\repos\Bellwood.AdminApi
dotnet run
```

### 2. **Human: Clear Previous Test Data**
```powershell
# PowerShell (if needed)
cd C:\Users\sgtad\source\repos\Bellwood.AdminApi
.\Scripts\Clear-TestData.ps1
```

### 3. **AI: Run Test Script**
```bash
# Git Bash or WSL
cd /c/Users/sgtad/source/repos/Bellwood.AdminApi
chmod +x Scripts/test-phase1-ownership.sh
./Scripts/test-phase1-ownership.sh
```

### 4. **AI: Analyze Output**
- Parse test results
- Identify failures
- Determine root causes

### 5. **AI: Make Fixes**
- Update code based on findings
- Rebuild project
- Document changes

### 6. **Human: Restart Servers**
```bash
# Ctrl+C in both terminals
# Re-run dotnet run commands
```

### 7. **AI: Re-test**
- Run script again
- Verify fixes worked
- Iterate until green

---

## ?? Test Checklist

Use this for manual verification after automated tests:

### Phase 1 - Ownership Testing

- [ ] **Step 1**: Alice authenticates ?
- [ ] **Step 2**: Affiliates/drivers seeded ?
- [ ] **Step 3**: Chris authenticates ?
- [ ] **Step 4**: Alice's quotes created (count: 5, owner: alice's userId) ?
- [ ] **Step 5**: Chris's quotes created (count: 5, owner: chris's userId) ?
- [ ] **Step 6**: Alice's bookings created (count: 8, owner: alice's userId) ?
- [ ] **Step 7**: Chris's bookings created (count: 8, owner: chris's userId) ?
- [ ] **Step 8**: Alice sees all 10 quotes ?
- [ ] **Step 9**: Chris sees only 5 quotes ?
- [ ] **Step 10**: Alice sees all 16 bookings ?
- [ ] **Step 11**: Chris sees only 8 bookings ?
- [ ] **Step 12**: Chris gets 403 when accessing Alice's quote ?

---

## ??? Troubleshooting

### Script Fails with "command not found: jq"
**Solution**: Install jq
```bash
# Git Bash (Windows)
curl -L -o /usr/bin/jq.exe https://github.com/stedolan/jq/releases/latest/download/jq-win64.exe

# WSL (Ubuntu)
sudo apt-get install jq

# macOS
brew install jq
```

### SSL Certificate Errors
**Solution**: Script already uses `-k` flag to ignore cert validation

### "Connection refused"
**Solution**: Ensure both servers are running:
- AuthServer: https://localhost:5001
- AdminAPI: https://localhost:5206

---

## ?? Expected Output (Success)

```
========================================
PHASE 1 - Ownership Testing
========================================

Step 1: Authenticating as Alice (admin)...
? Alice authenticated!
   userId: bfdb90a8-4e2b-4d97-bfb4-20eae23b6808
   role: admin

...

========================================
Phase 1 Testing Complete!
========================================

Summary:
  • Alice (admin) created: 5 quotes, 8 bookings
  • Chris (booker) created: 5 quotes, 8 bookings

Access Control Results:
  • Alice sees: ALL quotes (10), ALL bookings (16)
  • Chris sees: OWN quotes (5), OWN bookings (8)

? ALL TESTS PASSED (6/6)
```

---

## ?? Iteration Cycle

```
???????????????????????????????????????
? 1. Human: Start Servers             ?
???????????????????????????????????????
             ?
             ?
???????????????????????????????????????
? 2. AI: Run Test Script              ?
???????????????????????????????????????
             ?
             ?
???????????????????????????????????????
? 3. AI: Analyze Failures             ?
???????????????????????????????????????
             ?
             ?
???????????????????????????????????????
? 4. AI: Make Code Changes            ?
???????????????????????????????????????
             ?
             ?
???????????????????????????????????????
? 5. Human: Restart Servers           ?
???????????????????????????????????????
             ?
             ?
???????????????????????????????????????
? 6. AI: Re-test                      ?
???????????????????????????????????????
             ?
             ?? PASS ??? Done ?
             ?
             ?? FAIL ??? Back to Step 3
```

---

## ?? Tips

1. **Keep terminals visible**: Watch server logs for errors
2. **Clear data between runs**: Use `Clear-TestData.ps1` to start fresh
3. **Check console output**: AdminAPI logs show authorization decisions
4. **Use `jq` for debugging**: Pretty-print JSON responses

---

**Ready**: ? I'm ready to run tests whenever you start the servers!

